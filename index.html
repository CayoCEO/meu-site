<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Nosso universo ‚ú®</title>

  <!-- Fontes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    /* =========================================================
       RESET / BASE
    ========================================================= */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, Arial, sans-serif;
      color:#fff;
      overflow-x:hidden;
      background:
        radial-gradient(circle at 50% 120%, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0) 60%),
        radial-gradient(circle at 80% 0%, rgba(0,140,255,0.25) 0%, rgba(0,0,0,0) 50%),
        radial-gradient(circle at 20% -10%, rgba(255,200,255,0.25) 0%, rgba(0,0,0,0) 45%),
        linear-gradient(to bottom, #0a0f1e 0%, #0b1224 30%, #08101f 60%, #050b16 100%);
      background-attachment: fixed;
    }

    /* =========================================================
       MOSTRAR / ESCONDER SE√á√ïES
    ========================================================= */
    .u-hidden{display:none !important;}
    .u-show{display:block !important;}

    /* =========================================================
       NEVE (HOME)
    ========================================================= */
    .snow{
      position: fixed; inset:0; pointer-events:none; z-index:0;
      background-image:
        url("https://s3-us-west-2.amazonaws.com/s.cdpn.io/191814/flake1.png"),
        url("https://s3-us-west-2.amazonaws.com/s.cdpn.io/191814/flake2.png"),
        url("https://s3-us-west-2.amazonaws.com/s.cdpn.io/191814/flake3.png");
      background-repeat: repeat;
      background-size: 600px 600px;
      animation: snow 10s linear infinite;
      opacity:.85;
    }
    @keyframes snow{
      0%{background-position:0 0,0 0,0 0}
      50%{background-position:500px 500px,100px 200px,-100px 150px}
      100%{background-position:500px 1000px,200px 400px,-100px 300px}
    }

    /* =========================================================
       HOME / PORTAL
    ========================================================= */
    #home{
      position:relative;
      z-index:1;
      min-height:100vh;
      display:grid;
      place-items:center;
      padding:24px;
      text-align:center;
    }

    .btn{
      font-size: 1.15rem;
      padding: 1rem 2.3rem;
      border: none;
      border-radius: .6rem;
      cursor: pointer;
      text-transform: uppercase;
      font-weight: 900;
      background: rgb(14,14,26);
      color: rgb(234,234,234);
      box-shadow: 0 0 60px #1f4c65;
      transition: .35s;
    }
    .btn:hover{
      background: linear-gradient(270deg, rgba(2,29,78,0.68), rgba(31,215,232,0.87));
      color: rgb(4,4,38);
      transform: translateY(-2px);
    }
    .btn:active{transform: translateY(0) scale(.98)}

    .particles{
      position: absolute;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      width: 240px;
      height: 60px;
      pointer-events: none;
      z-index: 2;
      opacity:.9;
    }
    .particle{
      position:absolute;
      width:4px;height:4px;border-radius:99px;
      background: #b88cff;
      animation: float 3s infinite ease-in-out;
    }
    @keyframes float{
      0%{transform:translateY(0) scale(1);opacity:1}
      50%{transform:translateY(-20px) scale(1.2);opacity:.7}
      100%{transform:translateY(-40px) scale(.8);opacity:0}
    }

    /* =========================================================
       OVERLAY SENHA
    ========================================================= */
    .password-overlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.6);
      backdrop-filter: blur(8px);
      display:none;
      justify-content:center;
      align-items:center;
      z-index: 50;
      padding: 18px;
    }
    .password-box{
      width:min(360px, 100%);
      background: rgba(255,255,255,.12);
      border: 1px solid rgba(255,255,255,.25);
      backdrop-filter: blur(14px);
      border-radius: 24px;
      padding: 22px;
      text-align:center;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
    }
    .password-box h2{
      margin:0 0 12px;
      font-family:'Great Vibes', cursive;
      font-size: 38px;
      font-weight:400;
      color:#f3ecff;
    }
    .password-box input{
      width:100%;
      padding: 12px;
      border-radius: 12px;
      border: none;
      outline: none;
      margin-bottom: 12px;
      font-size: 16px;
    }
    .password-box button{
      width:100%;
      padding: 12px;
      border-radius: 14px;
      border: none;
      cursor:pointer;
      background: linear-gradient(135deg, #7b4dff, #b88cff);
      color:#fff;
      font-weight: 800;
      letter-spacing:.3px;
    }

    /* =========================================================
       UNIVERSO (ENCAPSULADO)
    ========================================================= */
    #universo{
      min-height:100vh;
      position:relative;
      color: rgba(255,255,255,.92);
      background: radial-gradient(1200px 800px at 15% 10%, #132055 0%, transparent 55%),
                  radial-gradient(900px 700px at 85% 20%, #2b0f2a 0%, transparent 55%),
                  linear-gradient(180deg, #060712, #0a0f24);
      overflow-x:hidden;
    }
    #universo #u-space{
      position:fixed; inset:0;
      width:100%; height:100%;
      z-index:0;
      filter:saturate(1.1) contrast(1.05);
    }
    #universo .u-vignette{
      position:fixed; inset:-40px;
      pointer-events:none;
      z-index:1;
      background:
        radial-gradient(900px 650px at 50% -10%, rgba(255,255,255,.08), transparent 60%),
        radial-gradient(900px 650px at 50% 110%, rgba(0,0,0,.6), transparent 58%),
        radial-gradient(1300px 900px at 50% 50%, transparent 45%, rgba(0,0,0,.55) 78%);
      mix-blend-mode: overlay;
    }
    #universo header, #universo main, #universo .u-modal{position:relative; z-index:2}

    #universo header{
      position:sticky; top:0; z-index:5;
      backdrop-filter: blur(12px);
      background: linear-gradient(180deg, rgba(6,7,18,.85), rgba(6,7,18,.35));
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    #universo .u-bar{
      max-width:1100px;
      margin:0 auto;
      padding:14px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    #universo .u-brand{display:flex; gap:12px; align-items:center}
    #universo .u-logo{
      width:40px;height:40px;border-radius:14px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 45%),
                  linear-gradient(135deg, rgba(108,198,255,.85), rgba(255,107,179,.75));
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 0 40px rgba(128,180,255,.45);
    }
    #universo .u-brand h1{margin:0;font-size:1.05rem;line-height:1.1}
    #universo .u-brand p{margin:2px 0 0;color:rgba(255,255,255,.65);font-size:.82rem}

    #universo .u-nav{display:flex; gap:10px; flex-wrap:wrap}
    #universo .u-chip{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      padding:10px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:800;
      transition:.2s;
      display:inline-flex; align-items:center; gap:8px;
    }
    #universo .u-chip:hover{transform:translateY(-1px); background:rgba(255,255,255,.10); border-color:rgba(255,255,255,.22)}

    #universo .u-wrap{max-width:1100px;margin:0 auto;padding:24px}
    #universo .u-hero{
      padding: 34px 0 14px;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 14px;
      align-items:stretch;
    }
    #universo .u-panel{
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border-radius: 26px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      overflow:hidden;
      position:relative;
    }
    #universo .u-panel .u-inner{padding:22px}
    #universo .u-title{
      font-family:"Great Vibes", cursive;
      font-size: clamp(2.2rem, 4.2vw, 3.9rem);
      line-height:.95;
      margin:0 0 10px;
    }
    #universo .u-lead{margin:0;color:rgba(255,255,255,.65);line-height:1.6}

    #universo .u-cta{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px; align-items:center}
    #universo .u-btn{
      border:none; cursor:pointer;
      padding: 12px 16px;
      border-radius: 14px;
      font-weight:900;
      letter-spacing:.4px;
      text-transform: uppercase;
      transition:.2s;
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
    }
    #universo .u-btn.primary{
      color:#071018;
      background: linear-gradient(135deg, rgba(108,198,255,1), rgba(255,107,179,1));
      box-shadow: 0 0 34px rgba(108,198,255,.18);
    }
    #universo .u-btn:hover{transform:translateY(-2px)}
    #universo .u-pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.65);
      font-weight:800;
    }
    #universo .u-dot{
      width:10px;height:10px;border-radius:99px;
      background:#48ffb6;
      box-shadow:0 0 18px rgba(72,255,182,.55);
      animation: u_pulse 1.4s infinite ease-in-out;
    }
    @keyframes u_pulse{0%,100%{transform:scale(1);opacity:.75}50%{transform:scale(1.6);opacity:1}}

    #universo .u-side{display:flex; flex-direction:column; gap:12px}
    #universo .u-mini{
      padding:16px;
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
    }
    #universo .u-mini h3{margin:0 0 8px}
    #universo .u-mini p{margin:0;color:rgba(255,255,255,.65);line-height:1.55}
    #universo .u-meter{
      margin-top: 12px;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      overflow:hidden;
    }
    #universo .u-meter i{
      display:block;height:100%;width:40%;
      background: linear-gradient(90deg, rgba(108,198,255,1), rgba(255,107,179,1));
      transition: width 1.2s ease;
    }

    #universo .u-grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 14px;
    }
    #universo .u-card{
      grid-column: span 4;
      padding: 18px;
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      box-shadow: 0 10px 35px rgba(0,0,0,.35);
    }
    #universo .u-card h4{margin:0 0 8px}
    #universo .u-card p{margin:0;color:rgba(255,255,255,.65);line-height:1.55}
    #universo .u-link{
      margin-top:12px;
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:900;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
    }

    /* Stories (suas imagens) */
    #universo .u-stories{display:flex; gap:10px; overflow-x:auto; padding-bottom:6px; margin-top:10px}
    #universo .u-story{flex:0 0 160px; height:220px; border-radius:14px; overflow:hidden; border:1px solid rgba(255,255,255,.12)}
    #universo .u-story img{width:100%; height:100%; object-fit:cover; display:block}

    /* Modal */
    #universo .u-modal{
      position:fixed; inset:0;
      display:none;
      place-items:center;
      padding: 18px;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      z-index: 999;
    }
    #universo .u-modal.open{display:grid}
    #universo .u-box{
      width:min(920px,100%);
      border-radius: 26px;
      border:1px solid rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: 0 30px 110px rgba(0,0,0,.65);
      overflow:hidden;
    }
    #universo .u-top{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      padding: 14px 18px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
    }
    #universo .u-x{
      width:40px;height:40px;border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      color:#fff; cursor:pointer; font-size:18px;
    }
    #universo .u-body{padding:18px}
    #universo .u-tabs{display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px}
    #universo .u-tab{
      padding:10px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      cursor:pointer; font-weight:900;
    }
    #universo .u-tab.active{background: rgba(108,198,255,.14); border-color: rgba(108,198,255,.35)}
    #universo .u-content{display:grid; grid-template-columns: 1.1fr .9fr; gap:14px}
    #universo .u-paper{
      border-radius:20px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      padding:16px;
      line-height:1.65;
      color: rgba(255,255,255,.86);
      min-height: 220px;
      white-space: pre-wrap;
    }
    #universo .u-aside{
      border-radius:20px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      padding:16px;
    }
    #universo .u-kpi{display:grid; gap:10px; margin-top:10px}
    #universo .u-kpi div{
      display:flex; justify-content:space-between; gap:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.65);
      font-weight:900;
    }

    @media (max-width:980px){
      #universo .u-hero{grid-template-columns:1fr}
      #universo .u-content{grid-template-columns:1fr}
      #universo .u-card{grid-column: span 6}
    }
    @media (max-width:640px){
      #universo .u-card{grid-column: span 12}
      #universo .u-btn{width:100%}
    }

/* =========================
   CONFIRMA√á√ÉO DE PROMESSA
========================= */
#universo .u-confirm{
  position: fixed;
  inset: 0;
  display: none;
  place-items: center;
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(10px);
  z-index: 1000;
}

#universo .u-confirm.show{
  display: grid;
}

#universo .u-confirm-box{
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
  border: 1px solid rgba(255,255,255,.2);
  border-radius: 24px;
  padding: 24px;
  width: min(320px, 90%);
  text-align: center;
  box-shadow: 0 20px 80px rgba(0,0,0,.6);
}

#universo .u-confirm-box p{
  margin: 0 0 18px;
  font-size: 1.1rem;
  font-weight: 800;
}

#universo .u-confirm-actions{
  display: flex;
  gap: 12px;
}
#universo .u-confirm-actions .u-btn{
  flex: 1;
}
/* =========================
   NEBULOSA 3D (Three.js)
========================= */
#nebula3D{
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  z-index: 0;
  pointer-events: none; /* importante: n√£o rouba clique do header */
}

#universo.nebula-on #nebula3D{
  display: block;
}

/* =========================
   MODO NEBULOSA ‚Äî CINEMA TOTAL
========================= */

/* Canvas 3D por cima de tudo */
#nebula3D{
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  z-index: 9999;
  pointer-events: auto;
}

/* Quando o modo nebulosa est√° ativo */
#universo.nebula-on #nebula3D{
  display: block;
}

/* ESCONDE TUDO */
#universo.nebula-on header,
#universo.nebula-on main,
#universo.nebula-on .u-nav,
#universo.nebula-on .u-confirm,
#universo.nebula-on .u-modal{
  display: none !important;
}

/* Estilo para o bot√£o de "Sair da Nebulosa" */
#exitNebulaWithButton{
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 10000;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

#universo.nebula-on #exitNebulaWithButton{
  opacity: 1;
  pointer-events: auto;
}


  </style>

<script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>


</head>

<body>
  <div class="snow" aria-hidden="true"></div>

  <!-- =========================
       HOME (PORTAL + SENHA)
  ========================== -->
  <section id="home" class="u-show">
    <div>
      <h1 style="margin:0 0 8px;font-family:'Great Vibes',cursive;font-size:54px;font-weight:400;">
        Aceita meu presente?
      </h1>
      <p style="margin:0 0 18px;color:rgba(255,255,255,.7);line-height:1.6;">
        Tem um portal escondido aqui. S√≥ abre com a senha. üíú
      </p>

      <button class="btn" id="btnPortal">Por aqui</button>

      <div class="particles" aria-hidden="true">
        <div class="particle" style="left:10%;animation-delay:0s"></div>
        <div class="particle" style="left:20%;animation-delay:.4s"></div>
        <div class="particle" style="left:30%;animation-delay:.8s"></div>
        <div class="particle" style="left:40%;animation-delay:1.2s"></div>
        <div class="particle" style="left:50%;animation-delay:1.6s"></div>
        <div class="particle" style="left:60%;animation-delay:2.0s"></div>
        <div class="particle" style="left:70%;animation-delay:2.4s"></div>
        <div class="particle" style="left:80%;animation-delay:2.8s"></div>
        <div class="particle" style="left:90%;animation-delay:3.2s"></div>
      </div>
    </div>
  </section>

  <!-- Overlay de senha -->
  <div class="password-overlay" id="passwordOverlay">
    <div class="password-box">
      <h2>Digite a senha üíú</h2>
      <input type="password" id="passwordInput" placeholder="senha..." />
      <button id="btnConfirm">Entrar</button>
      <button id="btnCancel" style="margin-top:10px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.14)">
        Cancelar
      </button>
    </div>
  </div>

  <!-- =========================
       UNIVERSO (EXTENS√ÉO)
  ========================== -->
  <section id="universo" class="u-hidden" aria-hidden="true">
    <canvas id="u-space"></canvas>
    <!-- CANVAS NEBULOSA 3D (modo especial) -->
<canvas id="nebula3D"></canvas>


<iframe
  id="uYT"
  style="display:none"
  width="0"
  height="0"
  src=""
  allow="autoplay">
</iframe>



    <div class="u-vignette"></div>

    <header>
      <div class="u-bar">
        <div class="u-brand">
          <div class="u-logo"></div>
          <div>
            <h1>Universo de voc√™s ‚ú®</h1>
            <p>feito pra ser sentido, n√£o s√≥ visto</p>
          </div>
        </div>

        <div class="u-nav">

<button class="u-chip" id="uMusic">
  M√∫sica <b id="uMusicState">OFF</b> üéß
</button>


          <button class="u-chip" id="uBack">‚¨Ö Voltar</button>
          <button class="u-chip" id="uOpen">Portal ü™ê</button>
          <button class="u-chip" id="uGlow">Modo <b id="uGlowState">NEBULOSA</b> üåå</button>
        </div>
      </div>
    </header>

    <main class="u-wrap">
      <section class="u-hero">
        <div class="u-panel">
          <div class="u-inner">
            <h2 class="u-title">Hoje eu abri um lugar<br> s√≥ nosso.</h2>
            <p class="u-lead">
              Tr√™s portas: <b>Cartas</b>, <b>Nossa Hist√≥ria</b> e <b>Nosso Futuro</b>.
              Cada clique muda o c√©u.
            </p>

            <div class="u-cta">
              <button class="u-btn primary" id="uStart">Abrir o portal ‚ú®</button>
              <div class="u-pill"><span class="u-dot"></span> <span id="uLive">Universo ativo.</span></div>
            </div>
          </div>
        </div>

        <div class="u-side">
          <div class="u-mini">
            <h3>Estado do universo</h3>
            <p id="uMood">est√°vel, aguardando intera√ß√£o üå†</p>
            <div class="u-meter"><i id="uMeter"></i></div>
          </div>

          <div class="u-mini">
            <h3>Mem√≥rias (suas fotos)</h3>
            <p style="margin-top:6px">Troque os caminhos das imagens se precisar.</p>
            <div class="u-stories">
              <div class="u-story"><img src="img/lembran√ßa1.jpg" alt="Lembran√ßa 1"></div>
              <div class="u-story"><img src="img/lembran√ßa2.jpg" alt="Lembran√ßa 2"></div>
              <div class="u-story"><img src="https://source.unsplash.com/featured/?ocean" alt="Lembran√ßa 3"></div>
              <div class="u-story"><img src="https://source.unsplash.com/featured/?mountain" alt="Lembran√ßa 4"></div>
            </div>
          </div>
        </div>
        <!-- CONFIRMA√á√ÉO DE PROMESSA -->
<div class="u-confirm" id="uConfirm">
  <div class="u-confirm-box">
    <p>isso √© uma promessa?</p>

    <div class="u-confirm-actions">
      <button class="u-btn" id="uNo">N√£o</button>
      <button class="u-btn primary" id="uYes">Sim üíñ</button>
    </div>
  </div>
</div>

<!-- BOT√ÉO DE INTERA√á√ÉO PARA A NEBULOSA -->
<button id="exitNebulaWithButton" class="u-chip" style="display:none;">Sair da Nebulosa ‚ú®</button>


      </section>

      <section class="u-grid">
        <div class="u-card">
          <h4>üì® Cartas</h4>
          <p>Mensagens que parecem pequenas‚Ä¶ at√© tocar no cora√ß√£o.</p>
          <div class="u-link" data-open="cartas">Abrir</div>
        </div>

        <div class="u-card">
          <h4>üï∞Ô∏è Nossa Hist√≥ria</h4>
          <p>Linha do tempo com detalhes que s√≥ voc√™s entendem.</p>
          <div class="u-link" data-open="historia">Abrir</div>
        </div>

        <div class="u-card">
          <h4>üöÄ Nosso Futuro</h4>
          <p>Planos, sonhos e promessas ‚Äî com um ‚Äúsim‚Äù no final.</p>
          <div class="u-link" data-open="futuro">Abrir</div>
        </div>
      </section>
    </main>

    <!-- Modal -->
    <div class="u-modal" id="uModal" aria-hidden="true">
      <div class="u-box" role="dialog" aria-modal="true">
        <div class="u-top">
          <strong id="uTitle">Portal</strong>
          <button class="u-x" id="uClose">‚úï</button>
        </div>
        <div class="u-body">
          <div class="u-tabs">
            <button class="u-tab" data-tab="cartas">Cartas</button>
            <button class="u-tab" data-tab="historia">Hist√≥ria</button>
            <button class="u-tab" data-tab="futuro">Futuro</button>
          </div>

          <div class="u-content">
            <div class="u-paper" id="uPaper"></div>

            <div class="u-aside">
              <b style="display:block;margin-bottom:8px">üå† Painel</b>
              <div class="u-kpi">
                <div><span>Batimento</span><b id="uBeat">ativo</b></div>
                <div><span>Destino</span><b id="uDest">alinhando</b></div>
              </div>

              <button class="u-btn primary" id="uFinal" style="margin-top:12px;width:100%">
                Pr√≥xima a√ß√£o üíñ
              </button>

              <p style="margin:10px 0 0;color:rgba(255,255,255,.65);line-height:1.5">
                
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </section>

  <script>
    /* =========================================================
       CONFIG
    ========================================================= */
    const SENHA_CORRETA = "recome√ßo";

    /* =========================================================
       HOME (senha)
    ========================================================= */
    const overlay = document.getElementById("passwordOverlay");
    const input = document.getElementById("passwordInput");

    document.getElementById("btnPortal").addEventListener("click", ()=>{
      overlay.style.display = "flex";
      setTimeout(()=> input.focus(), 50);
    });

    document.getElementById("btnCancel").addEventListener("click", ()=>{
      overlay.style.display = "none";
      input.value = "";
    });

    document.getElementById("btnConfirm").addEventListener("click", confirmarSenha);
    input.addEventListener("keydown", (e)=>{ if(e.key==="Enter") confirmarSenha(); });

    function confirmarSenha(){
      if(input.value === SENHA_CORRETA){
        overlay.style.display = "none";
        input.value = "";
        abrirUniverso();
      }else{
        alert("Senha incorreta üò¢");
      }
    }

    /* =========================================================
       PORTAL (HOME <-> UNIVERSO)
    ========================================================= */
    const HOME = document.getElementById("home");
    const UNI = document.getElementById("universo");

    function abrirUniverso(){
      HOME.classList.add("u-hidden");
      HOME.classList.remove("u-show");
      UNI.classList.remove("u-hidden");
      UNI.classList.add("u-show");
      UNI.setAttribute("aria-hidden","false");
      window.scrollTo(0,0);
      initUniverseOnce();
    }

    function voltarHome(){
      const modal = document.getElementById("uModal");
      modal.classList.remove("open");

      UNI.classList.add("u-hidden");
      UNI.classList.remove("u-show");
      UNI.setAttribute("aria-hidden","true");
      HOME.classList.remove("u-hidden");
      HOME.classList.add("u-show");
      window.scrollTo(0,0);
    }

    /* =========================================================
       UNIVERSO (UI)
    ========================================================= */
    const $u = (sel)=> UNI.querySelector(sel);
    const $$u = (sel)=> Array.from(UNI.querySelectorAll(sel));

    const uModal = $u("#uModal");
    const uPaper = $u("#uPaper");
    const uTitle = $u("#uTitle");
    const uTabs  = $$u(".u-tab");
    const uMeter = $u("#uMeter");
    const uMood  = $u("#uMood");
    const uLive  = $u("#uLive");
    const uBeat  = $u("#uBeat");
    const uDest  = $u("#uDest");

/* =========================================================
   NEBULOSA 3D (Three.js) ‚Äî Galaxy + intera√ß√£o
========================================================= */

const nebCanvas = document.getElementById("nebula3D");
let neb = {
  started: false,
  running: false,
  scene: null,
  camera: null,
  renderer: null,
  galaxy: null,
  raf: 0,
  drag: { on:false, x:0, y:0, vx:0, vy:0 },
  zoom: 6.5
};

function isUI(target){
  return !!(target && (
    target.closest("button") ||
    target.closest("a") ||
    target.closest("input") ||
    target.closest(".u-nav") ||
    target.closest(".u-modal") ||
    target.closest(".u-confirm") ||
    target.closest("#uModal") ||
    target.closest("#uConfirm")
  ));
}

function buildGalaxyPoints(){
  const isMobile = window.matchMedia("(max-width: 720px)").matches;
  const COUNT = isMobile ? 9000 : 20000;

  const arms = 4;               // bra√ßos da gal√°xia
  const radius = 5.2;
  const spin = 1.55;
  const randomness = 0.35;

  const positions = new Float32Array(COUNT * 3);
  const colors = new Float32Array(COUNT * 3);

  // cores (centro mais quente, borda mais fria)
  const cInner = { r: 1.0, g: 0.55, b: 0.25 };
  const cOuter = { r: 0.50, g: 0.70, b: 1.0 };

  for(let i=0;i<COUNT;i++){
    const i3 = i * 3;

    const r = Math.pow(Math.random(), 0.55) * radius;  // mais densidade no centro
    const branch = (i % arms) / arms * Math.PI * 2;
    const ang = branch + r * spin;

    const randX = (Math.random()*2 - 1) * randomness * (1 - r/radius);
    const randY = (Math.random()*2 - 1) * randomness * 0.35 * (1 - r/radius);
    const randZ = (Math.random()*2 - 1) * randomness * (1 - r/radius);

    positions[i3 + 0] = Math.cos(ang) * r + randX;
    positions[i3 + 1] = randY;
    positions[i3 + 2] = Math.sin(ang) * r + randZ;

    const t = r / radius;
    colors[i3 + 0] = cInner.r + (cOuter.r - cInner.r) * t;
    colors[i3 + 1] = cInner.g + (cOuter.g - cInner.g) * t;
    colors[i3 + 2] = cInner.b + (cOuter.b - cInner.b) * t;
  }

  const geom = new THREE.BufferGeometry();
  geom.setAttribute("position", new THREE.BufferAttribute(positions, 3));
  geom.setAttribute("color", new THREE.BufferAttribute(colors, 3));

  const mat = new THREE.PointsMaterial({
    size: isMobile ? 0.03 : 0.028,
    sizeAttenuation: true,
    depthWrite: false,
    vertexColors: true,
    transparent: true,
    blending: THREE.AdditiveBlending
  });

  const pts = new THREE.Points(geom, mat);

  // ‚Äúmiolo‚Äù brilhante
  const coreGeom = new THREE.BufferGeometry();
  const coreCount = isMobile ? 1000 : 2500;
  const corePos = new Float32Array(coreCount*3);
  for(let i=0;i<coreCount;i++){
    const i3=i*3;
    const rr = Math.pow(Math.random(), 2.2) * 1.1;
    const a = Math.random()*Math.PI*2;
    corePos[i3+0] = Math.cos(a)*rr;
    corePos[i3+1] = (Math.random()*2-1)*0.18;
    corePos[i3+2] = Math.sin(a)*rr;
  }
  coreGeom.setAttribute("position", new THREE.BufferAttribute(corePos,3));
  const coreMat = new THREE.PointsMaterial({
    size: isMobile ? 0.05 : 0.055,
    sizeAttenuation: true,
    color: new THREE.Color(1,0.8,0.55),
    transparent: true,
    depthWrite: false,
    blending: THREE.AdditiveBlending
  });
  const core = new THREE.Points(coreGeom, coreMat);

  const group = new THREE.Group();
  group.add(pts);
  group.add(core);

  return group;
}

function nebResize(){
  if(!neb.renderer || !neb.camera) return;
  const w = window.innerWidth;
  const h = window.innerHeight;
  neb.renderer.setSize(w, h, false);
  neb.camera.aspect = w / h;
  neb.camera.updateProjectionMatrix();
}

function nebInitOnce(){
  if(neb.started) return;
  neb.started = true;

  neb.scene = new THREE.Scene();

  neb.camera = new THREE.PerspectiveCamera(
    60,
    window.innerWidth / window.innerHeight,
    0.1,
    100
  );
  neb.camera.position.set(0, 1.1, neb.zoom);

  neb.renderer = new THREE.WebGLRenderer({
    canvas: nebCanvas,
    antialias: true,
    alpha: true,
    powerPreference: "high-performance"
  });
  neb.renderer.setPixelRatio(Math.min(2, window.devicePixelRatio || 1));
  nebResize();

  neb.galaxy = buildGalaxyPoints();
  neb.scene.add(neb.galaxy);

  // Intera√ß√£o: arrastar pra girar (sem atrapalhar UI)
  UNI.addEventListener("pointerdown", (e)=>{
    if(!document.getElementById("universo")?.classList.contains("nebula-on")) return;
    if(isUI(e.target)) return;
    neb.drag.on = true;
    neb.drag.x = e.clientX;
    neb.drag.y = e.clientY;
  });

  window.addEventListener("pointermove", (e)=>{
    if(!neb.drag.on || !neb.running) return;
    const dx = e.clientX - neb.drag.x;
    const dy = e.clientY - neb.drag.y;
    neb.drag.x = e.clientX;
    neb.drag.y = e.clientY;

    neb.drag.vx = dx * 0.0035;
    neb.drag.vy = dy * 0.0030;

    // aplica imediatamente (sensa√ß√£o responsiva)
    neb.galaxy.rotation.y += neb.drag.vx;
    neb.galaxy.rotation.x += neb.drag.vy;
    neb.galaxy.rotation.x = Math.max(-1.2, Math.min(1.2, neb.galaxy.rotation.x));
  });

  window.addEventListener("pointerup", ()=>{ neb.drag.on = false; });

  // Zoom (mouse wheel)
  window.addEventListener("wheel", (e)=>{
    if(!neb.running) return;
    // se estiver mexendo em UI, ignora
    if(isUI(e.target)) return;
    neb.zoom += (e.deltaY * 0.0025);
    neb.zoom = Math.max(3.2, Math.min(12, neb.zoom));
    neb.camera.position.z = neb.zoom;
  }, { passive:true });

  // Resize
  window.addEventListener("resize", nebResize);
}

function nebLoop(){
  if(!neb.running) return;

  // rota√ß√£o ‚Äúviva‚Äù mesmo sem mexer
  neb.galaxy.rotation.y += 0.0022;
  neb.galaxy.rotation.x += 0.0006;

  // in√©rcia do drag (soltou e ainda gira um pouco)
  neb.drag.vx *= 0.92;
  neb.drag.vy *= 0.92;
  neb.galaxy.rotation.y += neb.drag.vx;
  neb.galaxy.rotation.x += neb.drag.vy;

  neb.renderer.render(neb.scene, neb.camera);
  neb.raf = requestAnimationFrame(nebLoop);
}

function startNebula3D(){
  if(!nebCanvas || !window.THREE) {
    console.warn("Three.js ou canvas nebula3D n√£o carregou.");
    return;
  }
  nebInitOnce();
  if(neb.running) return;
  neb.running = true;

  // esconde o canvas antigo 2D (se existir)
  const old = document.getElementById("u-space");
  if(old) old.style.display = "none";

  nebResize();
  cancelAnimationFrame(neb.raf);
  neb.raf = requestAnimationFrame(nebLoop);
}

function stopNebula3D(){
  neb.running = false;
  cancelAnimationFrame(neb.raf);

const exitNebulaWithButton = document.getElementById("exitNebulaWithButton");

// Exibe o bot√£o quando a nebulosa for ativada
if (exitNebulaWithButton) {
  exitNebulaWithButton.addEventListener("click", () => {
    // Remove a classe "nebula-on" e para a nebulosa
    document.getElementById("universo").classList.remove("nebula-on");
    stopNebula3D();
  });
}

// Quando a nebulosa for ativada, o bot√£o aparece
window.addEventListener("click", () => {
  if (document.getElementById("universo").classList.contains("nebula-on")) {
    exitNebulaWithButton.style.display = "block";  // Torna o bot√£o vis√≠vel
  }
});


  // volta o canvas 2D
  const old = document.getElementById("u-space");
  if(old) old.style.display = "";

  // limpa o frame (opcional)
  if(neb.renderer) neb.renderer.clear?.();
}

/* =========================================================
   LIGA/DESLIGA NO SEU BOT√ÉO "Modo NEBULOSA"
========================================================= */

// Se voc√™ j√° tem isso no seu JS, s√≥ adicione as 3 linhas marcadas.
const uGlowBtn = $u("#uGlow");
const uGlowState = $u("#uGlowState");

// (se no seu c√≥digo j√° existe glowMode/glowNames, mant√©m)
let glowMode = 0;
const glowNames = ["NEBULOSA","AURORA","DARK"];

if(uGlowBtn){
  uGlowBtn.addEventListener("click", ()=>{
    glowMode = (glowMode + 1) % 3;
    if(uGlowState) uGlowState.textContent = glowNames[glowMode];

    // ‚úÖ AQUI: NEBULOSA LIGA 3D
    if(glowMode === 0){
      UNI.classList.add("nebula-on");
      startNebula3D();
      toast("Modo NEBULOSA (3D) üåå");
    }else{
      UNI.classList.remove("nebula-on");
      stopNebula3D();
      toast("Modo: " + glowNames[glowMode]);
    }
  });
}


/* =========================
   M√öSICA (YouTube) ‚Äî pausa real
========================= */
const uYT = document.getElementById("uYT");
const uMusic = $u("#uMusic");
const uMusicState = $u("#uMusicState");

const YT_URL = "https://www.youtube.com/embed/cEkd17gPTlk?autoplay=1&loop=1&playlist=cEkd17gPTlk";

let ytOn = false;

function ytPlay(){
  if(!uYT) return;
  uYT.style.display = "block";
  uYT.src = YT_URL;          // üî• isso inicia (autoplay=1)
  ytOn = true;
  if(uMusicState) uMusicState.textContent = "ON";
  toast("M√∫sica ON üéß");
}

function ytStop(){
  if(!uYT) return;
  uYT.src = "";              // üî• isso PARA DE VERDADE
  uYT.style.display = "none";
  ytOn = false;
  if(uMusicState) uMusicState.textContent = "OFF";
  toast("M√∫sica pausada ‚è∏Ô∏è");
}

if(uMusic && uYT){
  uMusic.addEventListener("click", ()=>{
    ytOn ? ytStop() : ytPlay();
  });
}


    const DATA = {
      cartas: [
        "Carta 1 ‚Äî\n\nEu programei um portal porque tinha coisa demais pra dizer em pouco espa√ßo.",
        "Carta 2 ‚Äî\n\nSe o mundo ficar barulhento, eu ainda encontro sil√™ncio em voc√™.",
        "Carta 3 ‚Äî\n\nO universo √© grande‚Ä¶ mas eu gosto mesmo √© do nosso universo."
      ],
      historia:
`Nossa Hist√≥ria ‚Äî\n
‚Ä¢ Um encontro que virou hitoria.\n
‚Ä¢ Uma risada que ficou.\n
‚Ä¢ Um detalhe pequeno que mudou tudo.\n
Final:\nEu te escolheria de novo, em qualquer vers√£o do tempo.`,
      futuro:
`Nosso Futuro ‚Äî\n
1) Planos leves, mas verdadeiros.\n
2) Viagens, m√∫sica e um lugar s√≥ nosso.\n
3) Uma promessa simples:\nEu escolho n√≥s.`
    };

    let tabAtiva = "cartas";
    let cartaIndex = 0;

    function toast(msg){
      uLive.textContent = msg;
      uLive.style.opacity = "0";
      setTimeout(()=> uLive.style.opacity = "1", 60);
    }

    function setMood(level){
      uMeter.style.width = Math.max(6, Math.min(100, level)) + "%";
      if(level < 35) uMood.textContent = "est√°vel, aguardando intera√ß√£o üå†";
      else if(level < 70) uMood.textContent = "brilho aumentando‚Ä¶ d√° pra sentir üí´";
      else uMood.textContent = "tempestade de estrelas: modo intenso üå†";
    }

    function openModal(tab){
      uModal.classList.add("open");
      uModal.setAttribute("aria-hidden","false");
      setTab(tab);
    }

    function closeModal(){
      uModal.classList.remove("open");
      uModal.setAttribute("aria-hidden","true");
    }

    function setTab(tab){
      tabAtiva = tab;
      uTabs.forEach(t=> t.classList.toggle("active", t.dataset.tab===tab));

      if(tab === "cartas"){
        uTitle.textContent = "üì® Cartas";
        uPaper.textContent = DATA.cartas[cartaIndex % DATA.cartas.length];
        $u("#uFinal").textContent = "Pr√≥xima carta üíå";
        uBeat.textContent = "acelerando";
        uDest.textContent = "mais perto";
        setMood(30 + (cartaIndex*19)%70);
      }
      if(tab === "historia"){
        uTitle.textContent = "üï∞Ô∏è Nossa Hist√≥ria";
        uPaper.textContent = DATA.historia;
        $u("#uFinal").textContent = "Marcar momento ‚ú®";
        uBeat.textContent = "nost√°lgico";
        uDest.textContent = "lembran√ßas";
        setMood(58);
      }
      if(tab === "futuro"){
        uTitle.textContent = "üöÄ Nosso Futuro";
        uPaper.textContent = DATA.futuro;
        $u("#uFinal").textContent = "Eu escolho n√≥s üíñ";
        uBeat.textContent = "corajoso";
        uDest.textContent = "alinhado";
        setMood(88);
      }
    }

    // Eventos universo
    $u("#uBack").addEventListener("click", voltarHome);
    $u("#uOpen").addEventListener("click", ()=> openModal("cartas"));
    $u("#uStart").addEventListener("click", ()=> openModal("cartas"));
    $u("#uClose").addEventListener("click", closeModal);

    uModal.addEventListener("click",(e)=>{ if(e.target===uModal) closeModal(); });

    $$u("[data-open]").forEach(el=>{
      el.addEventListener("click", ()=> openModal(el.dataset.open));
    });

    uTabs.forEach(t=>{
      t.addEventListener("click", ()=> setTab(t.dataset.tab));
    });

    const uConfirm = $u("#uConfirm");
const uYes = $u("#uYes");
const uNo = $u("#uNo");

$u("#uFinal").addEventListener("click", ()=>{
  if(tabAtiva === "cartas"){
    cartaIndex++;
    setTab("cartas");
    sparkleBurst(22);
  }
  else if(tabAtiva === "historia"){
    toast("Momento marcado no c√©u ‚ú®");
    sparkleBurst(40);
  }
  else if(tabAtiva === "futuro"){
    // üî• abre confirma√ß√£o
    uConfirm.classList.add("show");
  }
});

// N√ÉO = fecha
uNo.addEventListener("click", ()=>{
  uConfirm.classList.remove("show");
});

// SIM = registra promessa
uYes.addEventListener("click", ()=>{
  uConfirm.classList.remove("show");

  toast("Promessa registrada. üíñ");
  promiseMode(1600);
  sparkleBurst(60);

  // opcional: voc√™ pode travar o bot√£o depois
  // $u("#uFinal").disabled = true;
});


    // Part√≠culas r√°pidas
    function sparkleBurst(n=30){
      for(let i=0;i<n;i++){
        const s = document.createElement("div");
        const size = 3 + Math.random()*6;
        s.style.cssText = `
          position:fixed; left:${(50 + (Math.random()*30-15))}%; top:${(50 + (Math.random()*18-9))}%;
          width:${size}px; height:${size}px; border-radius:99px;
          background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(108,198,255,.7));
          box-shadow: 0 0 22px rgba(108,198,255,.35), 0 0 18px rgba(255,107,179,.25);
          pointer-events:none; z-index: 99999; transform: translate(-50%,-50%); opacity:.95;
        `;
        document.body.appendChild(s);
        const dx=(Math.random()*2-1)*(140+Math.random()*180);
        const dy=(Math.random()*2-1)*(120+Math.random()*160);
        const rot=(Math.random()*2-1)*240;

        s.animate([
          { transform:`translate(-50%,-50%) translate(0,0) rotate(0deg)`, opacity:.95 },
          { transform:`translate(-50%,-50%) translate(${dx}px,${dy}px) rotate(${rot}deg)`, opacity:0 }
        ], { duration: 720 + Math.random()*520, easing:"cubic-bezier(.18,.7,.2,1)" });

        setTimeout(()=> s.remove(), 1400);
      }
    }

    /* =========================================================
       CANVAS (estrelas) ‚Äî inicia s√≥ uma vez
    ========================================================= */
    const canvas = $u("#u-space");
    const ctx = canvas.getContext("2d", { alpha:true });

    let started=false, W=0, H=0, dpr=1;
    let stars=[], mouseX=0, mouseY=0, starBoost=false;

    function initUniverseOnce(){
      if(started) return;
      started=true;

      window.addEventListener("mousemove",(e)=>{ mouseX=e.clientX; mouseY=e.clientY; });
      window.addEventListener("touchmove",(e)=>{
        const t=e.touches && e.touches[0];
        if(t){ mouseX=t.clientX; mouseY=t.clientY; }
      }, {passive:true});
      window.addEventListener("resize", resize);

      resize();
      setMood(42);
      toast("Bem-vindo ao universo de voc√™s ‚ú®");
      requestAnimationFrame(draw);
    }

    function promiseMode(ms=2000){
      starBoost=true;
      setTimeout(()=> starBoost=false, ms);
    }

    function resize(){
      dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      W = window.innerWidth|0; H = window.innerHeight|0;
      canvas.width = (W*dpr)|0; canvas.height = (H*dpr)|0;
      canvas.style.width = W+"px"; canvas.style.height = H+"px";
      ctx.setTransform(dpr,0,0,dpr,0,0);
      buildStars();
    }

    function buildStars(){
      const count = ((W*H)/12000)|0;
      stars = Array.from({length:count}, ()=>({
        x:Math.random()*W, y:Math.random()*H, z:Math.random(),
        r:0.7+Math.random()*1.8, tw:Math.random()*Math.PI*2, sp:0.15+Math.random()*0.35
      }));
    }

    function draw(){
      ctx.clearRect(0,0,W,H);

      const g = ctx.createRadialGradient(W*0.5, H*0.35, 10, W*0.5, H*0.5, Math.max(W,H)*0.75);
      g.addColorStop(0, "rgba(108,198,255,0.08)");
      g.addColorStop(0.4, "rgba(255,107,179,0.04)");
      g.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,W,H);

      const mx = (mouseX - W/2) * 0.02;
      const my = (mouseY - H/2) * 0.02;

      for(const s of stars){
        s.tw += 0.02 + s.sp*0.02;
        const twinkle = 0.55 + Math.sin(s.tw)*0.45;

        const speed = (starBoost?1.9:1.0) * (0.15 + s.z*0.9);
        s.y += speed;
        if(s.y > H+10){ s.y = -10; s.x = Math.random()*W; }

        const px = s.x + mx*(1+s.z*2);
        const py = s.y + my*(1+s.z*2);

        const alpha = 0.15 + twinkle*0.85*(0.35 + s.z*0.65);
        const rad = s.r*(0.75 + s.z*0.85);

        ctx.beginPath();
        ctx.fillStyle = `rgba(255,255,255,${alpha})`;
        ctx.arc(px, py, rad, 0, Math.PI*2);
        ctx.fill();

        if(s.z > 0.65){
          ctx.beginPath();
          ctx.fillStyle = `rgba(108,198,255,${alpha*0.18})`;
          ctx.arc(px, py, rad*3.2, 0, Math.PI*2);
          ctx.fill();
        }
      }

      requestAnimationFrame(draw);
    }
  </script>
</body>
</html>
